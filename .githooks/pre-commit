#!/bin/bash
# Pre-commit hook: Run linting and tests before committing

set -e

echo "ğŸ” Running pre-commit checks..."
echo ""

# Activate virtual environment
if [ -f "timeseries-api/.venv/bin/activate" ]; then
    source timeseries-api/.venv/bin/activate
else
    echo "âŒ Virtual environment not found. Please run: uv venv timeseries-api/.venv"
    exit 1
fi

# Run linter
echo "ğŸ“ Running linter..."
if ! make lint; then
    echo ""
    echo "âŒ Linting failed! Fix issues with: make fix"
    echo ""
    exit 1
fi

echo ""
echo "âœ“ Linting passed!"
echo ""

# Run tests
echo "ğŸ§ª Running tests..."
if ! make test; then
    echo ""
    echo "âŒ Tests failed! Fix failing tests before committing."
    echo ""
    exit 1
fi

echo ""
echo "âœ“ Tests passed!"
echo ""
echo "âœ… All pre-commit checks passed! Proceeding with commit..."
echo ""
