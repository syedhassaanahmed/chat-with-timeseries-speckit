# Implementation Plan: Oil Well Time Series API

**Branch**: `001-oil-well-api` | **Date**: 2025-12-09 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-oil-well-api/spec.md`

**Note**: This template is filled in by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

Public REST API serving synthetic oil well time-series data (1 year, 3 wells, 5 metrics) with raw and aggregated query endpoints. Built with Python 3.14 + FastAPI, using SQLite for storage, uv for package management, and ruff for linting. Provides minute-level raw data and daily/monthly aggregations for demonstration and testing purposes.

## Technical Context

**Language/Version**: Python 3.14  
**Primary Dependencies**: FastAPI (latest), uvicorn (ASGI server), pydantic v2 (validation)  
**Storage**: SQLite (embedded database, indexed time-series tables)  
**Testing**: pytest, httpx (async HTTP client for API tests)  
**Target Platform**: Linux server (containerized via Dev Container)  
**Project Type**: Single backend API (no frontend)  
**Package Management**: uv (fast Python package installer and resolver)  
**Linting/Formatting**: ruff (fast Python linter and formatter)  
**Project Structure**: Monorepo with timeseries-api/ subdirectory  
**Constraints**: Read-only API, no authentication, minute-level data granularity  
**Scale/Scope**: 3 sample wells, 5 metrics, ~1 year of data (~7.9M data points, ~2.5 GB)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Justification |
|-----------|--------|---------------|
| **I. Simplicity & Clarity** | ✅ PASS | Single-purpose API with clear separation: data generation, business logic, API routes. SQLite eliminates external database complexity. FastAPI provides automatic OpenAPI docs. |
| **II. Generic & Modular** | ✅ PASS | Modular structure: `models/` (entities), `services/` (business logic), `api/` (routes), `db/` (storage). New metrics/wells can be added via configuration without code changes. |
| **III. Transparency & Documentation** | ✅ PASS | OpenAPI specification auto-generated by FastAPI. Will create README with setup instructions, API usage examples, and architecture documentation. Inline docstrings for all functions. |
| **IV. Testing & Validation** | ✅ PASS | Will include: contract tests (OpenAPI compliance), integration tests (endpoint behavior), unit tests (aggregation logic). pytest with >80% coverage target. |
| **V. Open Collaboration** | ⚠️ DEFERRED | Will add CONTRIBUTING.md and CODE_OF_CONDUCT.md in future PR. Initial implementation focuses on technical delivery. Ruff config ensures consistent code style. |
| **VI. Security & Data Privacy** | ✅ PASS | All data is synthetic (no real oilfield data). No authentication required (public API by design). Input validation via Pydantic models. No secrets or credentials in code. |
| **VII. Developer Experience** | ✅ PASS | MUST create .devcontainer/ configuration with Python 3.14, uv, ruff, and all dependencies. Dev Containers are non-negotiable per constitution. Will include complete devcontainer.json with features, extensions, and postCreateCommand. |

**Gate Decision**: ✅ PROCEED — One principle deferred to post-MVP (collaboration guidelines). Dev Container requirement is non-negotiable and will be implemented. Core technical principles satisfied.

---

### Post-Phase 1 Re-Evaluation

**Date**: 2025-12-09  
**Artifacts Generated**: research.md, data-model.md, contracts/openapi.yaml, quickstart.md

| Principle | Status | Post-Design Assessment |
|-----------|--------|------------------------|
| **I. Simplicity & Clarity** | ✅ PASS | Data model is straightforward (4 entities). SQLite schema uses simple indexed queries. No over-engineering detected. |
| **II. Generic & Modular** | ✅ PASS | Pydantic models are reusable. Service layer cleanly separated. Adding new metrics requires only configuration changes (no code). OpenAPI contract enables future client generation. |
| **III. Transparency & Documentation** | ✅ PASS | OpenAPI spec documents all 6 endpoints with schemas, examples, error codes (100% coverage per SC-007). quickstart.md provides setup instructions, API examples, and troubleshooting. data-model.md documents all entities and database schema. |
| **IV. Testing & Validation** | ✅ PASS | Test structure defined in project layout (contract, integration, unit tests). Pydantic models enforce validation at API boundaries. |
| **V. Open Collaboration** | ⚠️ DEFERRED | Ruff configuration ensures code style consistency. Still deferred: CONTRIBUTING.md, CODE_OF_CONDUCT.md, PR review process. |
| **VI. Security & Data Privacy** | ✅ PASS | Confirmed: all data is synthetic. Input validation enforced by Pydantic (well_id pattern, enum types, range constraints). No credentials in design. |
| **VII. Developer Experience** | ✅ PASS | quickstart.md documents manual setup. Dev Container configuration MUST be implemented (non-negotiable per constitution). Will include Python 3.14 base image, uv installation, all dependencies, VS Code extensions (Python, Ruff), and database initialization in postCreateCommand. |

**Final Gate Decision**: ✅ APPROVED FOR IMPLEMENTATION — Design satisfies all core technical principles. One deferred item (V: collaboration guidelines) does not block MVP delivery. Dev Container is required and will be implemented.

## Project Structure

### Documentation (this feature)

```text
specs/[###-feature]/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command)
├── data-model.md        # Phase 1 output (/speckit.plan command)
├── quickstart.md        # Phase 1 output (/speckit.plan command)
├── contracts/           # Phase 1 output (/speckit.plan command)
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
/workspaces/chat-with-timeseries-speckit/  # Repository root
├── ruff.toml                              # Shared linter config for all projects
├── Makefile                               # Shared build commands (test, lint, fix)
├── .githooks/                             # Git hooks
│   └── pre-commit                         # Run lint and test before commits
├── .devcontainer/                         # Dev Container configuration (REQUIRED)
│   ├── devcontainer.json                  # Container with Python 3.14, uv, extensions
│   └── postCreate.sh                      # Auto-install deps and seed database
├── specs/                                 # Feature specifications
│   └── 001-oil-well-api/                  # This feature
│       ├── plan.md, spec.md, research.md, etc.
│       └── contracts/openapi.yaml
└── timeseries-api/                        # API project subdirectory
    ├── README.md                          # API-specific documentation
    ├── pyproject.toml                     # uv project configuration
    ├── data/                              # SQLite database location
    │   └── timeseries.db                  # ~2.5 GB, 7.9M rows
    ├── src/
    │   ├── config.py                      # Configuration (3 wells, 5 metrics, 1 year)
    │   ├── models/                        # Pydantic models
    │   │   ├── __init__.py
    │   │   ├── well.py                    # Well model
    │   │   ├── metric.py                  # Metric model
    │   │   ├── timeseries.py              # TimeSeriesDataPoint model
    │   │   └── responses.py               # Response models (Raw, WellList, MetricList)
    │   ├── services/                      # Business logic
    │   │   ├── __init__.py
    │   │   ├── data_generator.py          # Synthetic data with decline curves
    │   │   └── query_service.py           # Query logic for raw data
    │   ├── api/                           # FastAPI routes
    │   │   ├── __init__.py
    │   │   ├── main.py                    # App initialization
    │   │   ├── wells.py                   # /wells endpoints
    │   │   ├── metrics.py                 # /metrics endpoints
    │   │   └── timeseries.py              # /wells/{id}/data/raw endpoint
    │   └── db/                            # Database layer
    │       ├── __init__.py
    │       ├── database.py                # SQLite connection management
    │       ├── schema.sql                 # Database schema
    │       └── seed.py                    # Initialize and seed database
    └── tests/
        ├── contract/                      # Placeholder (empty)
        ├── integration/                   # Placeholder (empty)
        └── unit/
            └── test_placeholder.py        # Placeholder test for pre-commit
```

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| [e.g., 4th project] | [current need] | [why 3 projects insufficient] |
| [e.g., Repository pattern] | [specific problem] | [why direct DB access insufficient] |
